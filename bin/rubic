#!/usr/bin/env ruby

require 'rubic'
require 'rubic/inspector'
require 'readline'

using Rubic::Inspector

# TODO: read the code from file when argument passed

puts "Welcome to interactive Rubic (v#{Rubic::VERSION})"
puts 'Hit ^D to exit'

rubic = Rubic::Interpreter.new

while input = Readline.readline(">> ", true)
  next if input.empty?
  while input.count('(') > input.count(')')
    input << Readline.readline(' | ', true)
  end

  begin
    puts '=> ' + rubic.evaluate(input).inspect
  rescue Rubic::RubicError => e
    puts "\e[31mError: #{e.message}\e[0m"
  end
end
